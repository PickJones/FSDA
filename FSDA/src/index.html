<!DOCTYPE html>
<html>
<head>
<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script-->
<!--script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script-->
<script src="jquery-3.1.1.js"></script>
<script src="jquery-csv.js"></script>
<script>
  //var playerData = [[][]];
  $(function() {
    $('#srchbox').keyup(function() { doSearch(document.getElementById('srchbox').value); });
    $('#rankcsv').bind('change', fileToArray);
  });
  function fileToArray(f) {
    var files = f.target.files;
    var file = files[0];
    var reader = new FileReader();
    reader.readAsText(file);
    reader.onload = function(event) {
      var csv = event.target.result;
      playerData = $.csv.toArrays(csv);
      var html = '';
      for (var row in playerData) {
        $('#output').append('row' + row + '<br>');
        for (var item in playerData[row]) {
          $('#output').append('item' + item + '<br>');
          html += '::' + playerData[row][item]+'::'
        }
        html += '<br>';
      }
      $('#outputcsv').html(html);
      var arrayStats = '';
      arrayStats += 'Imported ' + playerData.length + ' player(s)';
      //arrayStats += '<br>';
      //arrayStats += '# Columns = ' + playerData[0].length;
      $('#fileStats').append(arrayStats);
    };
    reader.onerror = function() { alert('Unable to read ' + file.fileName); };
  }
  function doSearch(s) {
    if (event.keyCode == 13) {
      srchterm="";
      $('#srchbox').val(srchterm);
    } else {
      srchterm = s;
    }
    if (srchterm.length > 0) {
      icons="<img src=\"../img/x.png\" height=\"15\" width=\"15\" onclick=\"clearSearchBox()\">&nbsp;&nbsp;";
      icons+="<img src=\"../img/check.png\" height=\"15\" width=\"15\" onclick=\"clearSearchBox()\">&nbsp;&nbsp;";
      icons+="<img src=\"../img/clear.jpg\" height=\"15\" width=\"15\" onclick=\"clearSearchBox()\">&nbsp;&nbsp;";
    } else {
      icons="";
    }
    $('#tmp').html(icons + srchterm);
  }
  function clearSearchBox() {
    $('#srchbox').val('');
    doSearch('');
    $('#srchbox').focus();
  }
  function resetConfirmation() {
    $('#confirm').html("<br><button onclick=\"doReset()\">Confirm</button><button onclick=\"cancelReset()\">Cancel</button>");
  }
  function cancelReset() {
    $('#confirm').empty();
  }
  function doReset() {
    clearSearchBox()
    $('#output').empty();
    $('#outputcsv').empty();
    $('#fileStats').empty();
    var playerDataStats = '';
    //playerData = [[][]];
    playerDataStats += '# Rows = ' + playerData.length;
    playerDataStats += '<br>';
    playerDataStats += '# Columns = ' + playerData[0].length;
    $('#fileStats').append(playerDataStats);
    $('#confirm').empty();
  }
</script>
</head>
<body>
  <input type="file" name="rankcsv" id="rankcsv">
  <br><div id="fileStats"></div>
  <hr>
  <table id="input" width="100%">
    <tr>
      <td>
        <input type="text" name="srchbox" id="srchbox" size=50>
      </td><td align="right">
        <button onclick="resetConfirmation()">Reset</button>
        <div id="confirm"></div>
      </td>
    </tr>
  </table>
  <hr>
  <table id="searchResults">
  </table>
  <hr>
  <table id="topPicks">
  </table>
  <hr>
  <table id="myTeam">
  </table>
  <hr>
  <table id="availP">
  </table>
  <hr>
  <table id="takenP">
  </table>
  <hr>
  <table border="1"><tr><td valign="top">
  <b>tmp</b><br>
  <div id="tmp"></div>
  </td><td valign="top">
  <b>output</b><br>
  <div id="output"></div>
  </td><td valign="top">
  <b>outputcsv</b><br>
  <div id="outputcsv"></div>
  </td></tr></table>
</body>
</html>
